<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="personnel">
	<select id="findByEmpNameContaining" resultType="java.util.Map">
		SELECT
		e.emp_idx, u.emp_name, e.pay_grade, e.position, e.dept_name,
		e.hire_date,
		e.employment_type, e.pay, s.bonus
		FROM employee e
		INNER JOIN
		users u ON e.user_idx = u.user_idx
		LEFT JOIN request r ON e.emp_idx =
		r.emp_idx
		LEFT JOIN salary s ON r.request_idx = s.request_idx
		WHERE
		u.emp_name LIKE CONCAT('%', #{keyword}, '%')
	</select>

	<select id="findByDeptNameContaining" resultType="java.util.Map">
		SELECT
		e.emp_idx, u.emp_name, e.pay_grade, e.position, e.dept_name,
		e.hire_date,
		e.employment_type, e.pay, s.bonus
		FROM employee e
		INNER JOIN
		users u ON e.user_idx = u.user_idx
		LEFT JOIN request r ON e.emp_idx =
		r.emp_idx
		LEFT JOIN salary s ON r.request_idx = s.request_idx
		WHERE
		e.dept_name LIKE CONCAT('%', #{keyword}, '%')
	</select>

	<select id="findByPositionContaining" resultType="java.util.Map">
		SELECT
		e.emp_idx, u.emp_name, u.pay_grade, e.position, e.dept_name,
		e.hire_date,
		e.employment_type, e.pay, s.bonus
		FROM employee e
		INNER JOIN
		users u ON e.user_idx = u.user_idx
		LEFT JOIN request r ON e.emp_idx =
		r.emp_idx
		LEFT JOIN salary s ON r.request_idx = s.request_idx
		WHERE
		e.position LIKE CONCAT('%', #{keyword}, '%')
	</select>

	<select id="paydtail" parameterType="String"
		resultType="java.util.Map">
		SELECT u.emp_name, u.emp_email, u.phone_number,
		e.team,
		e.position, e.pay_grade, e.hire_date,
		u.gender, e.emp_idx, e.pay,
		u.home, u.detail_home
		FROM employee e
		INNER JOIN users u ON e.user_idx =
		u.user_idx
		WHERE e.emp_idx = #{emp_idx}
	</select>

	<select id="payList" parameterType="String"
		resultType="java.util.Map">
		SELECT
		e.emp_idx,
		u.emp_name,
		s.payment_date,
		e.pay_grade,
		e.team,
		e.position,
		e.employment_type,
		e.pay,
		s.bonus
		FROM employee e
		INNER JOIN users u ON e.user_idx = u.user_idx
		LEFT JOIN request r ON e.emp_idx = r.emp_idx
		LEFT JOIN salary s ON r.request_idx = s.request_idx
		WHERE s.payment_date = #{payment_date}
		AND e.emp_idx = #{emp_idx}
	</select>
	
	<insert id="insertPay">
        INSERT INTO request (emp_idx, request_salary)
        VALUES (#{emp_idx}, 1);
        INSERT INTO salary (request_idx, base_salary, bonus, payment_date)
        VALUES (LAST_INSERT_ID(), #{base_salary}, #{bonus}, #{payment_date})
    </insert>
	
	
</mapper>













